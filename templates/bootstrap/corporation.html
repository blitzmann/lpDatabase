<?php include ('header.html') ?>
<?php include ('navbar.html') ?>

    <div class='container'>
        <div class='col-lg-10 col-md-offset-1'>
            <h3 class='nav'><?= $this->corpName ?></h3>
            <ul class='nav nav-tabs nav-justified'>
              <li class='active'><a href='#store' data-toggle="tab">LP Store</a></li>
              <li><a href='#info' data-toggle="tab">Info</a></li>
              <li><a href='#stations' data-toggle="tab">Stations</a></li>
            </ul>
            <div class='tab-content'>
                <div class='tab-pane active' id='store'>
                    <label class='checkbox'>
                        <input type='checkbox' class='toggle' id='filterToggle' value='true' data-toggle='filtering' /> Highlight
                    </label>
                    
                    <fieldset id='filtering'>
                        <?php foreach ($this->filterGroups AS $id => $name): ?>
                            <div class="col-md-3">
                                <label class='checkbox'><input type='checkbox' class='filter' value='<?= $id ?>' /> <?= $name ?></label>
                            </div>
                        <?php endforeach; ?>
                    </fieldset>
                    <table class='table table-striped table-hover table-condensed' id='offerList'>
                        <tr><th colspan='2'>Offer</th><th>Items Req</th><th>LP Cost</th><th>ISK Cost</th><th>Volume</th><th>ISK/LP</th></tr>
                        <?php foreach ($this->lpStore->offers AS $id => $offer): ?>
                            <tr data-filter='<?= $offer->marketRoot ?>'>
                                <td class='typeImg'>
                                    <div class='imgRound' style='background: url("http://image.eveonline.com/Type/<?= $offer->typeID ?>_32.png");'>
                                        <img width='32' height='32' src='http://image.eveonline.com/Type/<?= $offer->typeID ?>_32.png' alt='Corp Icon' />
                                    </div>
                                </td>
                                <td><a href='<?= BASE_PATH ?>offer/<?= $id ?>/'><?= $offer->getDisplayName() ?></a></td>
                                <td><?= count($offer->reqDetails) ?><?= ($offer->bpc) ? ' + '.count($offer->manDetails) : null ?></td>
                                <td><?= number_format($offer->lpCost) ?></td>
                                <td><?= number_format($offer->iskCost) ?></td>
                                <td><?= number_format($offer->totVolume) ?></td>
                                <td><?= number_format($offer->lp2isk) ?></td>
                            </tr>
                        <?php endforeach; ?>
                    </table>
                </div>
                <div class='tab-pane' id='info'>
                    <pre>Corp info here</pre>
                </div>
                <div class='tab-pane' id='stations'>
                    <table class='table table-striped table-hover table-condensed' id='stationList'>
                        <tr><th>Station</th><th>Region</th><th>Security</th></tr>
                        <?php foreach($this->lpStore->getStations() AS $station): ?>
                        <tr>
                            <td><?= $station['stationName'] ?></td>
                            <td><?= $station['regionName'] ?></td>
                            <td><?= number_format($station['security'],1) ?></td>
                        </tr>
                        <?php endforeach; ?>
                    </table>
                </div>
            </div>
        </div>
   </div><!-- /.container -->

<?php include ('scripts.html') ?>

<script>
    $(document).ready(function() { 
        // !- Bind checkboxes to show filters
        $('input[type="checkbox"].toggle').bind("change", function(){
            if (typeof $(this).data('toggle') != 'undefined') {
                if ($(this).is(":checked")) {
                    $("#"+$(this).data('toggle')).show(); }
                else {
                    $("#"+$(this).data('toggle')).hide();
                }
            }
        }).trigger('change');
        
        $('input[type="checkbox"].filter').bind("change", function(){
            // select all offers with filter id
            var filtered = $('*[data-filter="'+this.value+'"]');
            console.log("Affected offers: "+filtered.length);
            filtered.toggleClass('danger');
        }).trigger('toggle');
    });
</script>

<?php include ('footer.html') ?>